<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Flag - ä½ çš„ç›®æ ‡è¾¾æˆåŠ©æ‰‹</title>
    <!-- ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        
        :root { 
            --safe-top: env(safe-area-inset-top, 20px); 
            --safe-bottom: env(safe-area-inset-bottom, 20px); 
        }

        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent; 
            background-color: #FBFBFD; 
            margin: 0;
            overflow-x: hidden;
            color: #1D1D1F;
        }

        /* æ¸å˜ä¸é˜´å½±ä¼˜åŒ– */
        .flag-gradient { background: linear-gradient(135deg, #FF3B30 0%, #FF2D55 100%); }
        .glass-header { 
            background: rgba(251, 251, 253, 0.8); 
            backdrop-filter: saturate(180%) blur(20px); 
            -webkit-backdrop-filter: saturate(180%) blur(20px); 
        }
        
        .card-shadow {
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.04);
        }

        .safe-pb { padding-bottom: calc(var(--safe-bottom) + 6rem); }
        .safe-pt { padding-top: calc(var(--safe-top) + 4.5rem); }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.4s cubic-bezier(0.25, 1, 0.5, 1); }
        
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-item { animation: fadeIn 0.5s cubic-bezier(0.25, 1, 0.5, 1) forwards; }

        /* éšè—æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [isCreating, setIsCreating] = useState(false);
            const [inputText, setInputText] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [myFlags, setMyFlags] = useState([]);

            useEffect(() => {
                const saved = localStorage.getItem('flag_mobile_v2');
                if (saved) setMyFlags(JSON.parse(saved));
            }, []);

            useEffect(() => {
                localStorage.setItem('flag_mobile_v2', JSON.stringify(myFlags));
            }, [myFlags]);

            const handleAISplit = async () => {
                if (!inputText.trim()) return;
                setIsLoading(true);
                
                const apiKey = ""; 
                const systemPrompt = "ä½ æ˜¯ä¸€ä¸ªç›®æ ‡è§„åˆ’ä¸“å®¶ã€‚è¯·å°†ç”¨æˆ·ç›®æ ‡æ‹†è§£ä¸º3ä¸ªå…·ä½“çš„è¡ŒåŠ¨æ­¥éª¤ã€‚åªè¿”å›JSONæ ¼å¼ï¼Œå¦‚: {\"milestones\": [{\"title\": \"æ­¥éª¤1\"}, {\"title\": \"æ­¥éª¤2\"}, {\"title\": \"æ­¥éª¤3\"}]}";
                
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `ç›®æ ‡ï¼š${inputText}` }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });

                    const result = await response.json();
                    const aiData = JSON.parse(result.candidates[0].content.parts[0].text);
                    
                    const newFlag = {
                        id: Date.now(),
                        title: inputText,
                        progress: 0,
                        steps: aiData.milestones.map(m => ({ title: m.title, done: false })),
                        time: new Date().toLocaleDateString()
                    };

                    setMyFlags([newFlag, ...myFlags]);
                    setIsCreating(false);
                    setInputText('');
                } catch (err) {
                    const fallback = {
                        id: Date.now(),
                        title: inputText,
                        progress: 0,
                        steps: [
                            { title: "åˆ¶å®šåˆæ­¥æ‰§è¡Œè®¡åˆ’", done: false },
                            { title: "å¼€å¯ç¬¬ä¸€é˜¶æ®µä»»åŠ¡", done: false },
                            { title: "å¤ç›˜å¹¶å®Œæˆç›®æ ‡", done: false }
                        ],
                        time: new Date().toLocaleDateString()
                    };
                    setMyFlags([fallback, ...myFlags]);
                    setIsCreating(false);
                    setInputText('');
                } finally {
                    setIsLoading(false);
                }
            };

            const toggleStep = (flagId, idx) => {
                setMyFlags(myFlags.map(f => {
                    if (f.id === flagId) {
                        const newSteps = [...f.steps];
                        newSteps[idx].done = !newSteps[idx].done;
                        const progress = Math.round((newSteps.filter(s => s.done).length / newSteps.length) * 100);
                        return { ...f, steps: newSteps, progress };
                    }
                    return f;
                }));
            };

            const deleteFlag = (id) => {
                if (window.confirm("ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ")) {
                    setMyFlags(myFlags.filter(f => f.id !== id));
                }
            };

            return (
                <div className="min-h-screen flex flex-col">
                    {/* é¡¶éƒ¨æ  - è‹¹æœé£æ ¼ */}
                    <header className="fixed top-0 inset-x-0 glass-header z-30 px-6 pb-4 pt-[var(--safe-top)] border-b border-gray-100/50">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <span className="text-2xl">ğŸ¯</span>
                                <h1 className="text-xl font-extrabold tracking-tight">æˆ‘çš„ Flag</h1>
                            </div>
                            <div className="px-3 py-1 bg-gray-100 rounded-full">
                                <span className="text-[10px] font-bold text-gray-500 uppercase tracking-widest">v1.2 Pro</span>
                            </div>
                        </div>
                    </header>

                    {/* ä¸»å†…å®¹åŒº */}
                    <main className="px-5 safe-pt safe-pb">
                        <div className="space-y-6">
                            {myFlags.length === 0 && (
                                <div className="py-32 flex flex-col items-center justify-center opacity-20">
                                    <div className="text-8xl mb-6">ğŸš€</div>
                                    <p className="text-lg font-bold">è¿˜æ²¡æœ‰ Flagï¼Œå¿«å»å»ºç«‹ä¸€ä¸ª</p>
                                </div>
                            )}
                            {myFlags.map((flag, index) => (
                                <div 
                                    key={flag.id} 
                                    className="bg-white rounded-[2.5rem] p-7 card-shadow animate-item"
                                    style={{animationDelay: `${index * 0.1}s`}}
                                >
                                    <div className="flex justify-between items-start mb-6">
                                        <h2 className="text-2xl font-black text-gray-900 leading-tight pr-4">{flag.title}</h2>
                                        <button onClick={() => deleteFlag(flag.id)} className="p-2 -mr-2 opacity-20 hover:opacity-100 transition-opacity">
                                            <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"></path></svg>
                                        </button>
                                    </div>

                                    <div className="space-y-3 mb-8">
                                        {flag.steps.map((step, i) => (
                                            <div 
                                                key={i} 
                                                onClick={() => toggleStep(flag.id, i)}
                                                className={`flex items-center gap-4 p-4 rounded-2xl transition-all active:scale-[0.98] ${step.done ? 'bg-gray-50' : 'bg-gray-50/50 border border-gray-100'}`}
                                            >
                                                <div className={`w-6 h-6 rounded-full flex items-center justify-center border-2 transition-all duration-300 ${step.done ? 'bg-green-500 border-green-500 shadow-lg shadow-green-200' : 'border-gray-300'}`}>
                                                    {step.done && <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="4"><path d="M20 6L9 17l-5-5"></path></svg>}
                                                </div>
                                                <span className={`text-sm font-bold tracking-tight ${step.done ? 'text-gray-300 line-through' : 'text-gray-700'}`}>
                                                    {step.title}
                                                </span>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="flex items-end justify-between gap-4">
                                        <div className="flex-grow">
                                            <div className="flex justify-between mb-2">
                                                <span className="text-[10px] font-black text-gray-400 uppercase tracking-widest">Progress</span>
                                                <span className="text-[10px] font-black text-gray-900 uppercase">{flag.progress}%</span>
                                            </div>
                                            <div className="h-3 w-full bg-gray-100 rounded-full overflow-hidden p-[2px]">
                                                <div 
                                                    className="h-full flag-gradient rounded-full transition-all duration-1000 ease-out" 
                                                    style={{width: `${flag.progress}%`}}
                                                ></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>

                    {/* åº•éƒ¨æ‚¬æµ®æŒ‰é’® */}
                    <div className="fixed bottom-0 inset-x-0 p-6 pb-[calc(var(--safe-bottom)+1rem)] pointer-events-none flex justify-center">
                        <button 
                            onClick={() => setIsCreating(true)}
                            className="pointer-events-auto w-16 h-16 flag-gradient rounded-full shadow-[0_15px_30px_rgba(255,45,85,0.4)] flex items-center justify-center text-white text-4xl font-light active:scale-90 transition-all"
                        >
                            +
                        </button>
                    </div>

                    {/* å¼¹å‡ºå±‚ */}
                    {isCreating && (
                        <div className="fixed inset-0 z-50 flex items-end">
                            <div className="absolute inset-0 bg-black/30 backdrop-blur-sm" onClick={() => !isLoading && setIsCreating(false)}></div>
                            <div className="relative w-full bg-white rounded-t-[3.5rem] p-10 pb-[calc(var(--safe-bottom)+3rem)] animate-slide-up shadow-2xl">
                                <div className="w-12 h-1.5 bg-gray-100 rounded-full mx-auto mb-10"></div>
                                <h3 className="text-3xl font-black mb-8 tracking-tighter">æ–°ç›®æ ‡ï¼Œæ–°å¼€å§‹</h3>
                                <textarea 
                                    autoFocus
                                    value={inputText}
                                    onChange={(e) => setInputText(e.target.value)}
                                    placeholder="è¾“å…¥ä½ çš„ Flag..."
                                    className="w-full text-2xl font-bold p-0 border-none focus:ring-0 placeholder:text-gray-200 resize-none mb-10 leading-relaxed"
                                    rows="3"
                                />
                                <button 
                                    onClick={handleAISplit}
                                    disabled={isLoading || !inputText}
                                    className="w-full py-5 rounded-3xl bg-black text-white font-black tracking-widest uppercase disabled:bg-gray-100 disabled:text-gray-300 transition-all shadow-xl shadow-black/10 flex items-center justify-center gap-3"
                                >
                                    {isLoading ? (
                                        <>
                                            <div className="w-5 h-5 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
                                            <span>AI è§„åˆ’ä¸­</span>
                                        </>
                                    ) : "å¼€å¯æŒ‘æˆ˜"}
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
