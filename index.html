<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Flag - ä½ çš„ç›®æ ‡è¾¾æˆåŠ©æ‰‹</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        :root { --safe-top: env(safe-area-inset-top, 20px); --safe-bottom: env(safe-area-inset-bottom, 20px); }
        body { font-family: 'Inter', -apple-system, sans-serif; background-color: #F8F9FB; color: #1D1D1F; overflow: hidden; margin: 0; }
        
        .login-bg { background: #FDF4F4; }
        .flag-gradient { background: linear-gradient(135deg, #FF4D4D 0%, #F53D3D 100%); }
        .glass-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px); }
        
        /* 1. Flags é¡µé¢å¡ç‰‡æ ·å¼å›å½’ï¼ˆå‚è€ƒå›¾3ï¼‰ */
        .flag-card {
            background: white;
            border-radius: 2.5rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.02);
        }
        .flag-title { font-size: 1.25rem; font-weight: 800; color: #1D1D1F; margin-bottom: 1.5rem; }
        .task-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .check-circle { 
            width: 22px; height: 22px; border-radius: 50%; border: 2px solid #F2F2F7;
            display: flex; align-items: center; justify-content: center; transition: all 0.2s;
        }
        .check-circle.done { background: #FF4D4D; border-color: #FF4D4D; }
        .task-text { font-size: 0.95rem; font-weight: 600; color: #8E8E93; }
        .task-text.done { color: #D1D1D6; text-decoration: line-through; }
        
        /* è¿›åº¦æ¡æ ·å¼ï¼ˆå‚è€ƒå›¾3ï¼‰ */
        .progress-container { margin-top: 2rem; display: flex; align-items: center; justify-content: space-between; }
        .progress-bar-bg { flex-grow: 1; height: 4px; background: #F2F2F7; border-radius: 2px; overflow: hidden; margin-right: 12px; }
        .progress-bar-fill { height: 100%; background: #FF4D4D; transition: width 0.5s ease; }
        .progress-label { font-size: 10px; font-weight: 900; color: #D1D1D6; font-style: italic; }

        /* 2. è¾“å…¥æ¡†æ·±åº¦ä¼˜åŒ–ï¼šä¸Šç§»ä½ç½® */
        .input-modal-content {
            position: absolute;
            top: 12%; /* æ˜¾è‘—ä¸Šç§» */
            left: 5%;
            right: 5%;
            background: white;
            border-radius: 2.5rem;
            padding: 2rem;
            box-shadow: 0 30px 60px rgba(0,0,0,0.15);
            z-index: 101;
        }

        /* 3. ç»†èŠ‚å‹¾é€‰å¼¹çª— */
        .detail-select-modal {
            position: absolute;
            bottom: 0; left: 0; right: 0; top: 0;
            background: white;
            z-index: 105;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            border-radius: 2.5rem 2.5rem 0 0;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        
        .ai-bubble {
            background: #F2F2F7;
            padding: 1rem;
            border-radius: 1.25rem;
            border-bottom-left-radius: 0.25rem;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #3A3A3C;
        }

        /* å¹¿åœºå¡ç‰‡è¿˜åŸå›¾2 */
        .square-card {
            background: white;
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .square-tag { width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: justify-center; font-size: 10px; color: white; margin-right: 12px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [view, setView] = useState('login'); 
            const [isCreating, setIsCreating] = useState(false);
            const [myFlags, setMyFlags] = useState([
                { id: 1, title: 'å­¦ä¼šä½¿ç”¨ React Hooks', tasks: [{t: 'æŒæ¡ useState', d: true}, {t: 'æŒæ¡ useEffect', d: true}], progress: 100, color: '#34C759' },
                { id: 2, title: 'ä¸‰ä¸ªæœˆå­¦ä¼šæ¸¸æ³³', tasks: [{t: 'è´­ä¹°è£…å¤‡', d: true}, {t: 'ç»ƒä¹ æ¢æ°”', d: false}, {t: 'è‡ªç”±æ³³50ç±³', d: false}], progress: 30, color: '#FF4D4D' }
            ]);

            if (view === 'login') return <LoginScreen onLogin={() => setView('home')} />;
            return <MainContainer 
                view={view} 
                setView={setView} 
                isCreating={isCreating} 
                setIsCreating={setIsCreating} 
                myFlags={myFlags}
                setMyFlags={setMyFlags}
            />;
        }

        function LoginScreen({ onLogin }) {
            return (
                <div className="h-screen w-screen login-bg flex flex-col items-center justify-center px-6">
                    <div className="w-20 h-20 flag-gradient rounded-[2.2rem] shadow-xl flex items-center justify-center text-white text-4xl font-black italic mb-10 transform -rotate-6">F</div>
                    <div className="w-full max-w-sm bg-white rounded-[3rem] p-10 shadow-2xl">
                        <div className="text-center mb-10">
                            <h1 className="text-3xl font-black text-[#1D1D1F] mb-2">æ¬¢è¿å›æ¥</h1>
                            <p className="text-slate-400 font-bold text-sm">ç«‹ä¸ª FLAGï¼Œä¸‡ä¸€å®ç°äº†å‘¢</p>
                        </div>
                        <div className="space-y-4">
                            <input type="text" placeholder="é‚®ç®±/æ‰‹æœºå·" className="w-full bg-[#F7F8FA] border-none rounded-2xl p-5 font-bold outline-none" />
                            <input type="password" placeholder="å¯†ç " className="w-full bg-[#F7F8FA] border-none rounded-2xl p-5 font-bold outline-none" />
                            <button onClick={onLogin} className="w-full py-5 flag-gradient text-white rounded-[1.5rem] font-black shadow-lg">ç™»å½•</button>
                        </div>
                    </div>
                </div>
            );
        }

        function MainContainer({ view, setView, isCreating, setIsCreating, myFlags, setMyFlags }) {
            const publicFlags = [
                { id: 101, title: 'æŒ‘æˆ˜30å¤©ä¸å–å¥¶èŒ¶', progress: 85, sub: 'å¥¶èŒ¶æ·±åº¦æ‚£è€…', icon: 'ğŸ¥¤', color: '#FF3B30' },
                { id: 102, title: 'å¤‡æˆ˜é›…æ€è€ƒè¯• 8.0', progress: 45, sub: 'ALEX_W', icon: 'ğŸ“š', color: '#007AFF' }
            ];

            const toggleTask = (flagId, taskIndex) => {
                const updatedFlags = myFlags.map(f => {
                    if (f.id === flagId) {
                        const newTasks = [...f.tasks];
                        newTasks[taskIndex].d = !newTasks[taskIndex].d;
                        const doneCount = newTasks.filter(t => t.d).length;
                        return { ...f, tasks: newTasks, progress: Math.round((doneCount / newTasks.length) * 100) };
                    }
                    return f;
                });
                setMyFlags(updatedFlags);
            };

            return (
                <div className="h-screen w-screen flex flex-col overflow-hidden bg-[#F8F9FB]">
                    <header className="shrink-0 glass-header px-6 pb-4 pt-[var(--safe-top)] flex justify-between items-end h-24">
                        <h1 className="text-2xl font-black tracking-tighter uppercase">{view === 'home' ? 'Flags' : 'Square'}</h1>
                        <button className="text-[10px] font-black text-slate-200 uppercase mb-1">Logout</button>
                    </header>

                    <main className="flex-grow overflow-y-auto no-scrollbar px-5 py-4 pb-32">
                        {view === 'home' ? (
                            <div className="animate-in fade-in duration-500">
                                {myFlags.map(f => (
                                    <div key={f.id} className="flag-card">
                                        <div className="flag-title">{f.title}</div>
                                        <div className="space-y-1">
                                            {f.tasks.map((t, idx) => (
                                                <div key={idx} className="task-item" onClick={() => toggleTask(f.id, idx)}>
                                                    <div className={`check-circle ${t.d ? 'done' : ''}`}>
                                                        {t.d && <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="4"><polyline points="20 6 9 17 4 12"/></svg>}
                                                    </div>
                                                    <div className={`task-text ${t.d ? 'done' : ''}`}>{t.t}</div>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="progress-container">
                                            <div className="progress-bar-bg">
                                                <div className="progress-bar-fill" style={{ width: `${f.progress}%`, backgroundColor: f.color }}></div>
                                            </div>
                                            <div className="progress-label">{f.progress}%</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="space-y-3">
                                {publicFlags.map(f => (
                                    <div key={f.id} className="square-card shadow-sm">
                                        <div className="flex items-center">
                                            <div className="square-tag" style={{backgroundColor: f.color}}>{f.icon}</div>
                                            <div>
                                                <div className="font-black text-slate-800 text-sm">{f.title}</div>
                                                <div className="text-[10px] font-bold text-slate-300 uppercase">{f.sub}</div>
                                            </div>
                                        </div>
                                        <div className="text-xl font-black italic text-red-500">{f.progress}%</div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    {/* åº•éƒ¨å¯¼èˆª */}
                    <nav className="shrink-0 bg-white border-t border-slate-100 px-12 pb-[calc(var(--safe-bottom)+1rem)] pt-4 flex justify-between items-center z-30">
                        <button onClick={() => setView('home')} className={`flex flex-col items-center gap-1 ${view === 'home' ? 'text-red-500' : 'text-slate-300'}`}>
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>
                            <span className="text-[9px] font-black uppercase tracking-widest">Flags</span>
                        </button>
                        <button onClick={() => setIsCreating(true)} className="w-14 h-14 -mt-12 flag-gradient rounded-2xl shadow-xl flex items-center justify-center text-white text-3xl transform rotate-45 border-4 border-white active:scale-90 transition-all">
                            <span className="-rotate-45">+</span>
                        </button>
                        <button onClick={() => setView('discover')} className={`flex flex-col items-center gap-1 ${view === 'discover' ? 'text-red-500' : 'text-slate-300'}`}>
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="2" x2="12" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/></svg>
                            <span className="text-[9px] font-black uppercase tracking-widest text-center">Square</span>
                        </button>
                    </nav>

                    {isCreating && <AICreationModal onClose={() => setIsCreating(false)} onAdd={(f) => setMyFlags([f, ...myFlags])} />}
                </div>
            );
        }

        function AICreationModal({ onClose, onAdd }) {
            const [step, setStep] = useState(1); // 1: è¾“å…¥ç›®æ ‡, 2: è¯¦æƒ…å‹¾é€‰ç¡®è®¤
            const [inputText, setInputText] = useState('');
            const [loading, setLoading] = useState(false);
            const [aiMilestones, setAiMilestones] = useState([]);

            const handleStartDecomposition = async () => {
                setLoading(true);
                // æ¨¡æ‹Ÿ AI æ‹†è§£è¿‡ç¨‹
                await new Promise(r => setTimeout(r, 1500));
                
                // æ¨¡æ‹Ÿç”Ÿæˆçš„è¯¦ç»†æ­¥éª¤
                const mockMilestones = [
                    { t: 'è®¾å®šå…·ä½“å¯é‡åŒ–çš„å­¦ä¹ è®¡åˆ’', d: true },
                    { t: 'è´­ä¹°ç›¸å…³æ•™ææˆ–è¯¾ç¨‹', d: true },
                    { t: 'æ¯å¤©åšæŒç»ƒä¹  45 åˆ†é’Ÿ', d: true },
                    { t: 'ç¬¬ä¸€å‘¨å®ŒæˆåŸºç¡€ç†è®ºè‡ªæµ‹', d: false },
                    { t: 'åœ¨ç¤¾åŒºå‘å¸ƒä¸€ä¸ªç»ƒä¹ ä½œå“', d: false }
                ];
                setAiMilestones(mockMilestones);
                setStep(2);
                setLoading(false);
            };

            const toggleMilestone = (idx) => {
                const newM = [...aiMilestones];
                newM[idx].d = !newM[idx].d;
                setAiMilestones(newM);
            };

            const confirmAdd = () => {
                const selectedTasks = aiMilestones.filter(m => m.d);
                onAdd({
                    id: Date.now(),
                    title: inputText,
                    tasks: aiMilestones.map(m => ({ t: m.t, d: false })), // åˆå§‹çŠ¶æ€å‡ä¸ºæœªå®Œæˆ
                    progress: 0,
                    color: '#FF4D4D'
                });
                onClose();
            };

            return (
                <div className="fixed inset-0 z-[100]">
                    <div className="absolute inset-0 bg-slate-900/40 backdrop-blur-md" onClick={onClose} />
                    
                    {step === 1 && (
                        <div className="input-modal-content animate-slide-up">
                            <div className="ai-bubble">ä¸‹ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ï¼Ÿ</div>
                            <div className="space-y-6">
                                <textarea 
                                    autoFocus
                                    value={inputText}
                                    onChange={(e) => setInputText(e.target.value)}
                                    placeholder="è¾“å…¥ä½ çš„å®å¤§ç›®æ ‡..."
                                    className="w-full text-xl font-black border-none focus:ring-0 placeholder:text-slate-200 resize-none h-24 bg-transparent p-0"
                                />
                                <button 
                                    onClick={handleStartDecomposition}
                                    disabled={loading || !inputText}
                                    className="w-full py-5 rounded-[1.5rem] bg-black text-white font-black uppercase flex justify-center items-center h-[64px] active:scale-95 transition-all shadow-xl"
                                >
                                    {loading ? <div className="w-5 h-5 border-2 border-white/20 border-t-white rounded-full animate-spin"></div> : "å¼€å§‹æ™ºèƒ½æ‹†è§£"}
                                </button>
                            </div>
                        </div>
                    )}

                    {step === 2 && (
                        <div className="detail-select-modal animate-slide-up pt-[var(--safe-top)]">
                            <div className="flex justify-between items-center mb-8">
                                <h2 className="text-2xl font-black italic tracking-tighter">PLANNING</h2>
                                <button onClick={onClose} className="text-slate-300 font-bold uppercase text-xs">Cancel</button>
                            </div>
                            
                            <div className="bg-red-50 p-6 rounded-[2rem] mb-8">
                                <div className="text-[10px] font-black text-red-300 uppercase mb-1">Target</div>
                                <div className="text-xl font-black text-red-500">{inputText}</div>
                            </div>

                            <div className="flex-grow overflow-y-auto no-scrollbar">
                                <div className="text-[10px] font-black text-slate-300 uppercase mb-4 tracking-widest">ç¡®è®¤æ‰§è¡Œæ¸…å•</div>
                                <div className="space-y-4">
                                    {aiMilestones.map((m, i) => (
                                        <div key={i} onClick={() => toggleMilestone(i)} className={`p-5 rounded-2xl flex items-center gap-4 border-2 transition-all ${m.d ? 'border-red-500 bg-red-50/30' : 'border-slate-50 bg-white'}`}>
                                            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${m.d ? 'bg-red-500 border-red-500' : 'border-slate-100'}`}>
                                                {m.d && <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="4"><polyline points="20 6 9 17 4 12"/></svg>}
                                            </div>
                                            <div className={`font-bold text-sm ${m.d ? 'text-red-500' : 'text-slate-400'}`}>{m.t}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="py-6">
                                <button onClick={confirmAdd} className="w-full py-5 rounded-[1.5rem] flag-gradient text-white font-black shadow-xl active:scale-95 transition-all">
                                    ç¡®è®¤å¹¶æ·»åŠ åˆ°æˆ‘çš„ FLAG
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
