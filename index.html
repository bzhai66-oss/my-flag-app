<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Flag - ‰Ω†ÁöÑÁõÆÊ†áËææÊàêÂä©Êâã</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        :root { --safe-top: env(safe-area-inset-top, 20px); --safe-bottom: env(safe-area-inset-bottom, 20px); }
        body { font-family: 'Inter', -apple-system, sans-serif; background-color: #F8F9FB; color: #1D1D1F; overflow: hidden; margin: 0; }
        
        .flag-gradient { background: linear-gradient(135deg, #FF4D4D 0%, #F53D3D 100%); }
        .glass-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px); }
        
        /* ÁôªÂΩïÈ°µÁâπÂÆöÊ†∑Âºè (Âõæ1Â§çÂàª) */
        .login-card { background: white; border-radius: 4rem; padding: 3.5rem 2.5rem; box-shadow: 0 50px 100px -20px rgba(0,0,0,0.05); }
        .login-logo { width: 80px; height: 80px; border-radius: 50%; display: flex; items-center; justify-content: center; font-size: 2.5rem; font-weight: 900; color: white; font-style: italic; box-shadow: 0 10px 30px rgba(245, 61, 61, 0.3); margin-top: -40px; }
        .social-btn { background: #F8F9FB; border-radius: 1.5rem; padding: 1.2rem; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 700; color: #3A3A3C; font-size: 0.9rem; }
        .divider { height: 1px; background: #F2F2F7; position: relative; width: 100%; margin: 2rem 0; }
        .divider-text { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); background: white; padding: 0 1rem; color: #D1D1D6; font-size: 0.75rem; font-weight: 800; }

        /* Flag Âç°ÁâáÊ†∑Âºè (Âõæ3Â§çÂàª) */
        .flag-card { background: white; border-radius: 2.5rem; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.02); }
        .flag-title { font-size: 1.25rem; font-weight: 800; color: #1D1D1F; margin-bottom: 1.2rem; }
        .task-item { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; cursor: pointer; }
        .check-circle { width: 22px; height: 22px; border-radius: 50%; border: 2px solid #F2F2F7; display: flex; align-items: center; justify-content: center; }
        .check-circle.done { background: #FF4D4D; border-color: #FF4D4D; }
        .task-text { font-size: 0.95rem; font-weight: 600; color: #8E8E93; }
        .task-text.done { color: #D1D1D6; text-decoration: line-through; }
        
        /* ËøõÂ∫¶Êù°Ê†∑Âºè */
        .progress-container { margin-top: 1.8rem; display: flex; align-items: center; justify-content: space-between; }
        .progress-bar-bg { flex-grow: 1; height: 4px; background: #F2F2F7; border-radius: 2px; overflow: hidden; margin-right: 12px; }
        .progress-bar-fill { height: 100%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .progress-label { font-size: 10px; font-weight: 900; color: #D1D1D6; font-style: italic; min-width: 30px; text-align: right; }

        /* AI ËæìÂÖ•‰∏éËßÑÂàíÊ†∑Âºè */
        .input-center-modal { position: absolute; top: 15%; left: 5%; right: 5%; background: white; border-radius: 2.5rem; padding: 2rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.2); z-index: 101; }
        .planning-overlay { position: fixed; inset: 0; background: white; z-index: 200; display: flex; flex-direction: column; padding: 2rem; padding-top: calc(var(--safe-top) + 1rem); padding-bottom: calc(var(--safe-bottom) + 1rem); }
        .ai-status-bubble { background: #F2F2F7; padding: 0.8rem 1.2rem; border-radius: 1.25rem 1.25rem 1.25rem 0.2rem; font-size: 0.85rem; font-weight: 700; margin-bottom: 1.2rem; color: #3A3A3C; display: inline-block; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .square-item { background: white; border-radius: 1.5rem; padding: 1.2rem 1.5rem; margin-bottom: 0.8rem; display: flex; align-items: center; justify-content: space-between; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- Â≠êÁªÑ‰ª∂: ÁôªÂΩïÈ°µ (Â§çÂàªÂõæ1) ---
        function LoginView({ onLogin }) {
            return (
                <div className="h-screen w-screen flex flex-col items-center justify-center px-6 bg-[#FDF4F4]">
                    <div className="flex flex-col items-center w-full max-w-sm">
                        <div className="login-logo flag-gradient mb-8 transform -rotate-2">F</div>
                        <div className="login-card w-full text-center">
                            <h1 className="text-3xl font-black text-[#1D1D1F] mb-1 tracking-tight">Ê¨¢ËøéÂõûÊù•</h1>
                            <p className="text-[#8E8E93] font-bold text-sm mb-12">Á´ã‰∏™ FLAGÔºå‰∏á‰∏ÄÂÆûÁé∞‰∫ÜÂë¢</p>
                            
                            <div className="space-y-4">
                                <input type="text" placeholder="ÈÇÆÁÆ±/ÊâãÊú∫Âè∑" className="w-full bg-[#F8F9FB] border-none rounded-2xl p-5 font-bold outline-none placeholder:text-slate-300" />
                                <input type="password" placeholder="ÂØÜÁ†Å" className="w-full bg-[#F8F9FB] border-none rounded-2xl p-5 font-bold outline-none placeholder:text-slate-300" />
                                <button onClick={onLogin} className="w-full py-5 flag-gradient text-white rounded-2xl font-black shadow-lg active:scale-95 transition-transform mt-2">ÁôªÂΩï</button>
                            </div>

                            <div className="divider">
                                <span className="divider-text">ÊàñËÄÖ</span>
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                                <button className="social-btn active:scale-95 transition-all">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/7/7e/Circle-icons-profile.svg" className="w-5 h-5 opacity-40" /> ÂæÆ‰ø°
                                </button>
                                <button className="social-btn active:scale-95 transition-all">
                                    <img src="https://www.google.com/favicon.ico" className="w-4 h-4" /> Google
                                </button>
                            </div>
                        </div>
                        <p className="mt-10 text-[#8E8E93] font-bold text-sm">ËøòÊ≤°ÊúâË¥¶Âè∑Ôºü <span className="text-[#1D1D1F]">ÁÇπÂáªÊ≥®ÂÜå</span></p>
                    </div>
                </div>
            );
        }

        // --- Â≠êÁªÑ‰ª∂: AI ÊãÜËß£‰∏éÂãæÈÄâÂºπÁ™ó (ÈÄªËæë‰øùÁïô) ---
        function CreationFlow({ onClose, onConfirm }) {
            const [step, setStep] = useState(1); 
            const [goalText, setGoalText] = useState('');
            const [loading, setLoading] = useState(false);
            const [milestones, setMilestones] = useState([]);

            const handleAnalyze = async () => {
                if (!goalText) return;
                setLoading(true);
                await new Promise(r => setTimeout(r, 1200));
                const mockResults = [
                    { id: 1, text: 'ÂáÜÂ§áÂøÖË¶ÅÁöÑ‰∏ì‰∏öÂ∑•ÂÖ∑ÂíåÂü∫Á°ÄÁâ©Êñô', checked: true },
                    { id: 2, text: 'Âà∂ÂÆöÊØèÊó• 30 ÂàÜÈíüÁöÑÂõ∫ÂÆöÁªÉ‰π†ËÆ°Âàí', checked: true },
                    { id: 3, text: 'ÂÆåÊàêÁ¨¨‰∏ÄÈò∂ÊÆµÁöÑÂü∫Á°ÄÁêÜËÆ∫Â≠¶‰π†‰∏éËá™Êµã', checked: true },
                    { id: 4, text: 'Â∞ùËØïÂà∂‰ΩúÁ¨¨‰∏Ä‰∏™ÂèØÂ±ïÁ§∫ÁöÑÂ∞èÂûã Demo', checked: false },
                    { id: 5, text: 'Âêë‰∏ì‰∏ö‰∫∫Â£´ÂØªÊ±ÇÂèçÈ¶àÂπ∂ËøõË°å‰∫åÊ¨°‰ºòÂåñ', checked: false }
                ];
                setMilestones(mockResults);
                setStep(2);
                setLoading(false);
            };

            const toggleCheck = (id) => {
                setMilestones(prev => prev.map(m => m.id === id ? {...m, checked: !m.checked} : m));
            };

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center">
                    <div className="absolute inset-0 bg-black/30 backdrop-blur-sm" onClick={() => !loading && onClose()} />
                    {step === 1 ? (
                        <div className="input-center-modal w-[90%] max-w-md animate-in fade-in zoom-in-95 duration-200">
                            <div className="ai-status-bubble">Hi! ÂëäËØâÊàë‰Ω†ÊÉ≥ÊåëÊàò‰ªÄ‰πàÔºü</div>
                            <textarea autoFocus value={goalText} onChange={(e) => setGoalText(e.target.value)} placeholder="ËæìÂÖ•‰Ω†ÁöÑÂÆèÂ§ßÁõÆÊ†á..."
                                className="w-full text-xl font-black border-none focus:ring-0 placeholder:text-slate-200 resize-none h-32 bg-transparent p-0 mb-6" />
                            <button onClick={handleAnalyze} disabled={loading || !goalText} className="w-full py-5 rounded-2xl bg-[#1D1D1F] text-white font-black uppercase flex justify-center items-center shadow-xl active:scale-95 transition-all">
                                {loading ? <div className="w-6 h-6 border-2 border-white/20 border-t-white rounded-full animate-spin"></div> : "ÂºÄÂßã AI Êô∫ËÉΩÊãÜËß£"}
                            </button>
                        </div>
                    ) : (
                        <div className="planning-overlay animate-in slide-in-from-bottom duration-300">
                            <div className="flex justify-between items-center mb-8">
                                <h2 className="text-2xl font-black italic tracking-tighter uppercase">Planning</h2>
                                <button onClick={onClose} className="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-400">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><path d="M18 6L6 18M6 6l12 12"/></svg>
                                </button>
                            </div>
                            <div className="bg-red-50 p-6 rounded-[2rem] mb-8 border border-red-100/50">
                                <div className="text-[10px] font-black text-red-300 uppercase mb-1 tracking-widest">Main Target</div>
                                <div className="text-xl font-black text-red-500">{goalText}</div>
                            </div>
                            <div className="flex-grow overflow-y-auto no-scrollbar">
                                <div className="space-y-3">
                                    {milestones.map((m) => (
                                        <div key={m.id} onClick={() => toggleCheck(m.id)} className={`p-5 rounded-2xl flex items-center gap-4 border-2 transition-all ${m.checked ? 'border-red-500 bg-red-50/40' : 'border-slate-50 bg-white'}`}>
                                            <div className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center ${m.checked ? 'bg-red-500 border-red-500' : 'border-slate-100'}`}>
                                                {m.checked && <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="4"><polyline points="20 6 9 17 4 12"/></svg>}
                                            </div>
                                            <div className={`font-bold text-sm leading-tight ${m.checked ? 'text-red-500' : 'text-slate-400'}`}>{m.text}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            <div className="pt-6">
                                <button onClick={() => onConfirm(goalText, milestones.filter(m => m.checked))} className="w-full py-5 rounded-[1.5rem] flag-gradient text-white font-black shadow-xl active:scale-95 transition-all uppercase tracking-widest">Á°ÆËÆ§Âπ∂ÂêåÊ≠•Âà∞ Flags</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // --- ‰∏ªÁ®ãÂ∫èÂÆπÂô® (ÁªìÊûÑÂÆåÂÖ®‰øùÁïô) ---
        function App() {
            const [view, setView] = useState('login'); 
            const [tab, setTab] = useState('home'); 
            const [isCreating, setIsCreating] = useState(false);
            const [myFlags, setMyFlags] = useState([
                { id: 1, title: 'Â≠¶‰ºö‰ΩøÁî® React Hooks', tasks: [{t: 'ÊéåÊè° useState', d: true}, {t: 'ÊéåÊè° useEffect', d: true}], progress: 100, color: '#34C759' },
                { id: 2, title: '‰∏â‰∏™ÊúàÂ≠¶‰ºöÊ∏∏Ê≥≥', tasks: [{t: 'Ë¥≠‰π∞Ë£ÖÂ§á', d: true}, {t: 'ÁªÉ‰π†Êç¢Ê∞î', d: false}, {t: 'Ëá™Áî±Ê≥≥50Á±≥', d: false}], progress: 30, color: '#FF4D4D' }
            ]);

            const publicFlags = [
                { id: 101, title: 'ÊåëÊàò30Â§©‰∏çÂñùÂ•∂Ëå∂', progress: 85, sub: 'Â•∂Ëå∂Ê∑±Â∫¶ÊÇ£ËÄÖ', icon: 'ü•§', color: '#FF3B30' },
                { id: 102, title: 'Â§áÊàòÈõÖÊÄùËÄÉËØï 8.0', progress: 45, sub: 'ALEX_W', icon: 'üìö', color: '#007AFF' },
                { id: 103, title: 'ÊâìÈÄ†‰∏Ä‰∏™ÂºÄÊ∫ê UI Â∫ì', progress: 12, sub: 'ÊûÅÂÆ¢Âº†', icon: 'üé®', color: '#5856D6' },
                { id: 104, title: 'Â≠¶‰π†Ê≥ïÂºèÁÉπÈ•™', progress: 90, sub: 'Â∞èÂé®Â®ò', icon: 'üç≥', color: '#FF9500' }
            ];

            const handleToggleTask = (flagId, taskIndex) => {
                setMyFlags(prev => prev.map(f => {
                    if (f.id === flagId) {
                        const newTasks = [...f.tasks];
                        newTasks[taskIndex].d = !newTasks[taskIndex].d;
                        const progress = Math.round((newTasks.filter(t => t.d).length / newTasks.length) * 100);
                        return { ...f, tasks: newTasks, progress };
                    }
                    return f;
                }));
            };

            const handleAddNewFlag = (title, selectedMilestones) => {
                const newFlag = {
                    id: Date.now(),
                    title,
                    tasks: selectedMilestones.map(m => ({ t: m.text, d: false })),
                    progress: 0,
                    color: '#FF4D4D'
                };
                setMyFlags([newFlag, ...myFlags]);
                setIsCreating(false);
                setTab('home');
            };

            if (view === 'login') return <LoginView onLogin={() => setView('main')} />;

            return (
                <div className="h-screen w-screen flex flex-col overflow-hidden bg-[#F8F9FB]">
                    <header className="shrink-0 glass-header px-6 pb-4 pt-[var(--safe-top)] flex justify-between items-end h-24 z-10">
                        <h1 className="text-2xl font-black tracking-tighter uppercase italic">{tab === 'home' ? 'Flags' : 'Square'}</h1>
                        <button onClick={() => setView('login')} className="text-[10px] font-black text-slate-300 uppercase mb-1 tracking-widest">Logout</button>
                    </header>

                    <main className="flex-grow overflow-y-auto no-scrollbar px-5 py-4 pb-32">
                        {tab === 'home' ? (
                            <div className="animate-in fade-in slide-in-from-bottom-2 duration-500">
                                {myFlags.map(f => (
                                    <div key={f.id} className="flag-card">
                                        <div className="flag-title">{f.title}</div>
                                        <div className="space-y-2">
                                            {f.tasks.map((t, idx) => (
                                                <div key={idx} className="task-item" onClick={() => handleToggleTask(f.id, idx)}>
                                                    <div className={`check-circle ${t.d ? 'done' : ''}`}>
                                                        {t.d && <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="4"><polyline points="20 6 9 17 4 12"/></svg>}
                                                    </div>
                                                    <div className={`task-text ${t.d ? 'done' : ''}`}>{t.t}</div>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="progress-container">
                                            <div className="progress-bar-bg">
                                                <div className="progress-bar-fill" style={{ width: `${f.progress}%`, backgroundColor: f.color }}></div>
                                            </div>
                                            <div className="progress-label">{f.progress}%</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="space-y-2 animate-in fade-in duration-500">
                                {publicFlags.map(f => (
                                    <div key={f.id} className="square-item">
                                        <div className="flex items-center">
                                            <div className="w-10 h-10 rounded-xl flex items-center justify-center text-lg mr-4 bg-slate-50">{f.icon}</div>
                                            <div>
                                                <div className="font-extrabold text-[#1D1D1F] text-sm leading-tight">{f.title}</div>
                                                <div className="text-[10px] font-bold text-slate-300 uppercase mt-0.5">{f.sub}</div>
                                            </div>
                                        </div>
                                        <div className="text-xl font-black italic" style={{color: f.color}}>{f.progress}%</div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    <nav className="shrink-0 bg-white/90 backdrop-blur-md border-t border-slate-100 px-12 pb-[calc(var(--safe-bottom)+1rem)] pt-4 flex justify-between items-center z-50">
                        <button onClick={() => setTab('home')} className={`flex flex-col items-center gap-1.5 ${tab === 'home' ? 'text-red-500' : 'text-slate-300'}`}>
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>
                            <span className="text-[9px] font-black uppercase tracking-widest">Flags</span>
                        </button>
                        <button onClick={() => setIsCreating(true)} className="w-14 h-14 -mt-12 flag-gradient rounded-[1.25rem] shadow-2xl flex items-center justify-center text-white text-3xl transform rotate-45 border-[6px] border-[#F8F9FB] active:scale-90 transition-all">
                            <span className="-rotate-45 font-light">+</span>
                        </button>
                        <button onClick={() => setTab('square')} className={`flex flex-col items-center gap-1.5 ${tab === 'square' ? 'text-red-500' : 'text-slate-300'}`}>
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="2" x2="12" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/></svg>
                            <span className="text-[9px] font-black uppercase tracking-widest">Square</span>
                        </button>
                    </nav>

                    {isCreating && <CreationFlow onClose={() => setIsCreating(false)} onConfirm={handleAddNewFlag} />}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
